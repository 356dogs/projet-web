<html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Game 4x2</title>
    <link rel="stylesheet" href="JeuMemory.css">
</head>
<body>
    <header>
        <h1>Jeu en cours</h1>
        <h3>TEMPS : 0</h3>
    </header>
    <div class="Grille-jeu" id="Grille-jeu">

    </div>

    <script type="module">

        import { Creation_grille, Gestion_retournement} from './Gestion_Grille.js';
        import { liste_cartes } from './Gestion_Cartes.js';
        import { difffacile, diffmoyen, diffdifficile } from './Gestion_Cartes.js';

       window.onload = () => {
            const difficulty = localStorage.getItem('difficulty');
            if (difficulty === 'facile') {
                difffacile();
            } else if (difficulty === 'moyen') {
                diffmoyen();
            } else if (difficulty === 'difficile') {
                diffdifficile();
            }
        };
        

        // Creation de la grille aleatoire 
        const grille = Creation_grille(x_grille, y_grille, liste_cartes);
        
        // On saisie la grille html dans le code
        const grille_html = document.getElementById('Grille-jeu');

        //on a besoin d'un compteur pour savoir combien de cartes on a retourner.
        let nb_cartes_retourne = 0;
        
        for(let y = 1; y < y_grille+1; y++){ // y colonnes
            const divLigne = document.createElement('div'); //pour ajuster l'espace ligne par ligne (dans le CSS)
            divLigne.className = 'DivLigne';


            for(let x = 1; x < x_grille+1; x++){ // x lignes
                const divCarte = document.createElement('div');
                divCarte.className = 'DivCarte';

                const backSide = document.createElement('img');
                backSide.className = 'carte-back';
                backSide.src = "cartes/Carte_back.jpg";

                const frontSide = document.createElement('img');
                frontSide.className = 'carte-front';
                frontSide.src = grille[y-1][x-1].front_side;
                
                divCarte.appendChild(backSide);
                divCarte.appendChild(frontSide);

                divCarte.addEventListener('click', () => {
                    nb_cartes_retourne++;
                    grille[y-1][x-1].retourne = true;
                    //on retourne la carte dans le html
                    divCarte.classList.add('flipped');
                    
                    Gestion_retournement(grille, nb_cartes_retourne, x, y);
                });

                divLigne.appendChild(divCarte);
            }
            grille_html.appendChild(divLigne);
        }
    </script>
</body>
</html>